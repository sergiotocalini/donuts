{% extends "base.html" %}
{% block js%}
<script>
{% include 'libs.js' %}
	$( document ).ready(function() {	
		$("#add-dns").click(function(event) {
			console.log('hey!');
			$('#AddDNS').modal('show');
		});
		$(".remove_dns").click(function(event) {
			event.preventDefault();
			var url = $(this).attr('href');
       		console.log(url);
			bootbox.confirm("Are you sure you want to remove this ddns?", function(result) {
       			 if (result == true){

       			 	callUrlAndReload(url);
		        }
    		}); 
		});
		$('.sync-dns').click(function(event){
			var id = $(this).data('id');
			var content = $('#diff_' + id).html();
			console.log(content);
			var url = '{{url_for('dns_servers_sync')}}?id=' + id;
			bootbox.confirm(content, function(result) {
       			 if (result == true){
                    window.location.replace(url);
                 }
    		}); 

		})
	});
</script>

{% endblock%}

{% block search_nav %}{% endblock %}
{% block main %}
	<nav class="navbar navbar-custom">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header col-md-4">
				<button type="button" id="add-dns" class=" btn btn-success  navbar-btn "> <i class="fa fa-plus"></i> Add Server</button> 
			</li>
		</div>
		<!-- Collect the nav links, forms, and other content for toggling -->
		</div><!-- /.container-fluid -->
	</nav>

<div class="panel panel-default">
	<table id="Table"
		 class="table table-compact table-striped table-hover table-bordered table-condensed table-compact table-nowrap" 
		cellspacing="0">
		<thead>
			<tr>
				<th>ip</th>
				<th>Secret Key</th>
				<th>path</th>
				<th>type</th>
				<th>zones</th>
				<th>differences</th>
				<th>last update</th>
				<th>Working</th>
				<th>delete</th>
			</tr>
		</thead>
		<tbody >
			{% for dns in ctx.dnss %}
			<tr id="{{dns._id}}">
				<td>
					{{dns.ip}}
				</td>
				<td>
					{{dns.secret_key}}
				</td>
				<td>
					{{dns.path}}
				</td>
				<td>
					{{dns.type}}
				</td>
				<td>{{dns.zones_len}}</td>
				<td>
					{% if dns.zones_diff_len %}
						<a href='#' class='sync-dns' data-id='{{dns._id}}'> 	{{dns.zones_diff_len}} </a>
						<div id="diff_{{dns._id}}" class='hide'>
							<strong> zones: </strong>
							<br/>
							{% for zone in dns.zones_diff %}
								<strong> {{zone}} </strong><br/>
							{% endfor%}
						</div>
					{% endif %}
				</td>

				<td>
					{{dns.last_update}}
				</td>
				<td>
					{% if dns.working%}
						<i class="fa fa-check"></i>
					{% else %}
					<i class="fa fa-times"></i>
					{% endif %}

				</td>
				<td>
				   <a class='remove_dns' href='{{url_for('delete_dns')}}?id={{dns._id}}' ><i class='fa fa-trash'></i> </a> 
				</td>

			</tr>	
			{% endfor %}
		</tbody>
	</table>
</div>


{% endblock %}

{% block modals%}

<!-- Modal Add -->
<div class="modal fade bs-example-modal-lg" id="AddDNS" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog" style="width: 400">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
				<h4 class="centered modal-title" id="AddDDNSModalZoneName">Add DDNS </h4>
			</div>
			<div class="modal-body">

				<form id="AddDNSForm" role="form" style='padding-left: 10px; width: 355px' class="form form-horizontal" method='POST'>
					<div class="form-group">
							<input required type="ddns" class="form-control" id="ip" name="ip" placeholder="IP">
					</div>

					<div class="form-group">
							<input required type="ddns" class="form-control" id="secret_key" name="secret_key" placeholder="Secret Key">
					</div>

					<div class="form-group">
							<input required type="ddns" class="form-control" id="path" name="path" placeholder="path (eg: http://localhost:5000/)">
					</div>

					<div class="form-group">
							<select class="form-control "  name="type" id="type" >
								{% if not ctx.master_exists %}
								<option>Master</option>
								{% endif %}
								<option>Slave</option>
							</select>

					</div>
					<button type="submit" class="btn btn-primary">Submit</button>

				</form>
			</div>
		</div>
	</div>
</div>
<!-- /Modal Add -->

{% endblock %}
